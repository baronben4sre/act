#!/bin/bash

# Usage: ./$0 nbTransactions nbMonths  (Ex: ./$0 200 3)
# Generated by Copilot (with minor updates). Prompt: generate a fake CSV file with 200 lines. Here the format of the CSV: Customer Number,Account Currency,Account Number,Account Type,Transaction Date,Transaction Posted Date,Amount,Type,Description,FITID

# Check if number of rows is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <number_of_rows> [<number_of_months>]"
  echo "Usage: $0 200 3"
  exit 1
fi

ROWS=$1
MONTH=$2; [[ -z "$MONTH" ]] && MONTH=3
CUSTOMER="1023456789"
CURRENCY="USD"
ACCOUNT="1234567890"
TYPE="Checking"
START_DATE=$(date -d @$(( $(date +%s) - $(( $MONTH * 2592000 )) ))  +%s)
OUTPUT_FILE="expenses_generated.csv"
DAYSPAN=$(( $MONTH * 30 ))
# Generate CSV Header
echo "Customer Number,Account Currency,Account Number,Account Type,Transaction Date,Transaction Posted Date,Amount,Type,Description,FITID" > $OUTPUT_FILE

# Descriptions to choose from
DESCRIPTIONS=("Grocery Store" "The shop not classified" "HOMEDEPOT" "Coffee Shop" "BESTBUY" "VEHICLE TAG" "CIRCLE K Eureka" "Salary" "NETATMO" "CVS/PHARMACY" "TICKET" "LOWES" "HOME ASSISTANT" "PIZZERIA" "MCDONALD" "Sushi" "THE UPS STORE" "ATM Withdrawal")

# Loop to generate rows
for i in $(seq 1 $ROWS); do
  TRANS_DATE=$(date -d @$(( $START_DATE + $(( $((RANDOM % $DAYSPAN)) * 86400)) )) +%Y-%m-%d)
  AMOUNT_RAW=$(( (RANDOM % 10000) + 500 ))
  AMOUNT=$(echo "scale=2; $AMOUNT_RAW / 100" | bc)

  if (( RANDOM % 4 == 0 )); then
    TYPE_TXN="Credit"
    AMOUNT=$AMOUNT
    DESC="Salary"
  else
    TYPE_TXN="Debit"
    AMOUNT=-$AMOUNT
    DESC=${DESCRIPTIONS[$((RANDOM % ${#DESCRIPTIONS[@]}))]}
  fi

  FITID="TXN$(printf "%07d" $i)"
  echo "$CUSTOMER,$CURRENCY,$ACCOUNT,$TYPE,$TRANS_DATE,$TRANS_DATE,$AMOUNT,$TYPE_TXN,$DESC,$FITID" >> $OUTPUT_FILE
done

echo "$ROWS transactions generated in $OUTPUT_FILE"
echo "Ready to mv $OUTPUT_FILE $ACTBASE/data/incoming"
